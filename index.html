<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-ICC æ™ºèƒ½åº”æ€¥æŒ‡æŒ¥ä¸­å¿ƒ | å¼•å¯¼ä¼˜åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pingan-orange': '#FF7D00',
                        'side-bg': '#ffffff',
                        'light-bg': '#ffffff',
                        'light-panel': '#f3f4f6',
                        'light-border': '#e5e7eb',
                        'light-text': '#1f2937',
                        'light-subtext': '#6b7280',
                        dash: { bg: '#020617', panel: '#0f172a', border: '#1e293b' },
                        ai: { DEFAULT: '#7c3aed', light: '#a78bfa' },
                        danger: '#ef4444',
                        success: '#10b981'
                    },
                    fontSize: { 'xxs': '0.65rem' },
                    animation: {
                        'scan': 'scan 3s linear infinite',
                        'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite',
                        'breathe': 'breathe 2s ease-in-out infinite', // æ–°å¢å‘¼å¸åŠ¨ç”»
                    },
                    keyframes: { 
                        scan: { '0%': { top: '0%' }, '100%': { top: '100%' } },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', boxShadow: '0 0 0 0 rgba(255, 255, 255, 0.4)' },
                            '50%': { transform: 'scale(1.05)', boxShadow: '0 0 12px 4px rgba(255, 255, 255, 0.2)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .nav-badge { position: absolute; top: -2px; right: 4px; background-color: #ef4444; color: white; border-radius: 9999px; font-size: 9px; padding: 0 4px; border: 1px solid #ffffff; transform: scale(0.8); }
        .dashboard-container { background: radial-gradient(circle at center, #0f172a 0%, #020617 100%); box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.8); }
        .timeline-node.active { box-shadow: 0 0 10px #3b82f6; border-color: #60a5fa; background: #2563eb; }
        .timeline-node.done { background: #059669; border-color: #059669; }
        .doc-item:hover { background-color: #f0f9ff; }
        .markdown-body h1 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; color: #1e293b; }
        .markdown-body h2 { font-size: 1.2em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; color: #334155; border-bottom: 1px solid #e2e8f0; padding-bottom: 4px; }
        .markdown-body p { margin-bottom: 0.8em; line-height: 1.6; color: #475569; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; color: #475569; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin-bottom: 1em; }
        .markdown-body th, .markdown-body td { border: 1px solid #e2e8f0; padding: 6px; text-align: left; font-size: 0.9em; }
        .markdown-body th { background-color: #f8fafc; }
        .sim-toast { animation: slideInDown 0.5s ease-out forwards; }
        @keyframes slideInDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>

<body class="bg-gray-100 h-screen w-screen overflow-hidden flex flex-col font-sans text-sm">

    <!-- 0. TOP SHELL -->
    <div class="h-10 w-full bg-pingan-orange flex items-center px-4 shrink-0 text-white font-bold z-[60] shadow-md">
        å¿«ä¹å¹³å®‰
    </div>

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex overflow-hidden">

        <!-- 1. FAR LEFT SIDEBAR -->
        <aside class="w-[70px] bg-white border-r border-light-border flex flex-col items-center py-4 shrink-0 text-gray-500 select-none z-50">
            <div class="space-y-6 flex flex-col items-center w-full">
                <div class="relative group cursor-pointer text-center"><i class="fa-solid fa-envelope text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">é‚®ä»¶</div><div class="nav-badge">99+</div></div>
                <div class="relative group cursor-pointer text-center"><i class="fa-solid fa-comment-dots text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">æ¶ˆæ¯</div><div class="nav-badge">8</div></div>
                <div class="group cursor-pointer text-center"><i class="fa-regular fa-address-book text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">é€šè®¯å½•</div></div>
                <div class="group cursor-pointer text-center"><i class="fa-solid fa-calendar-days text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">æ—¥ç¨‹</div></div>
                <div class="group cursor-pointer text-center"><i class="fa-brands fa-yahoo text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">å·¥ä½œå°</div></div>
                <div class="group cursor-pointer text-center"><i class="fa-solid fa-clipboard-check text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">ç­¾æŠ¥</div></div>
                <div class="group cursor-pointer text-center w-12 h-12 bg-blue-700/90 rounded-lg flex flex-col items-center justify-center text-white shadow-lg"><i class="fa-solid fa-share-nodes text-lg mb-0.5"></i><div class="text-[9px] font-bold">åä½œ</div></div>
                <div class="group cursor-pointer text-center mt-2"><i class="fa-solid fa-bell text-xl mb-1 group-hover:text-pingan-orange"></i><div class="text-[10px]">å‘Šè­¦</div></div>
            </div>
            <div class="mt-auto relative">
                <img src="https://i.pravatar.cc/150?u=1" class="w-10 h-10 rounded-full border-2 border-gray-200 opacity-80 hover:opacity-100 cursor-pointer">
                <div class="absolute bottom-0 right-0 w-3 h-3 bg-red-500 rounded-full border border-white"></div>
            </div>
        </aside>

        <!-- 2. CHAT LIST -->
        <section class="w-[260px] bg-light-bg border-r border-light-border flex flex-col shrink-0">
            <div class="h-12 border-b border-light-border flex items-center justify-between px-3">
                <h2 class="font-bold text-gray-800 text-sm">ä¸šåŠ¡åä½œä¸­å¿ƒ</h2>
                <div class="flex space-x-2 text-gray-500"><i class="fa-solid fa-magnifying-glass cursor-pointer hover:text-blue-600"></i><i class="fa-solid fa-plus cursor-pointer hover:text-blue-600"></i></div>
            </div>
            <div class="flex border-b border-light-border text-xs">
                <button class="flex-1 py-2 text-blue-600 border-b-2 border-blue-600 font-medium bg-blue-50">è¿›è¡Œä¸­ 10</button>
                <button class="flex-1 py-2 text-gray-500 hover:bg-gray-50">å·²ç»“æŸ</button>
            </div>
            <div class="flex-1 overflow-y-auto bg-white">
                <div class="p-3 bg-blue-50 border-l-4 border-blue-600 cursor-pointer hover:bg-blue-100 transition">
                    <div class="flex justify-between items-start mb-1"><span class="font-bold text-gray-900 text-xs truncate w-32">æ¼”ç»ƒNOC2025...</span><span class="text-xxs text-gray-500">11:53</span></div>
                    <p class="text-xxs text-gray-600 truncate">AIç®¡å®¶: æ¬§äºšè²é‚€è¯·æ‚¨åŠ å…¥äº†è¯¥...</p>
                </div>
                <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer group">
                    <div class="flex justify-between items-start mb-1"><span class="font-bold text-gray-700 text-xs group-hover:text-black">ææ•ˆå·¥ç¨‹å›¢é˜Ÿç®¡ç†</span><span class="text-xxs text-gray-400">10:00</span></div>
                    <p class="text-xxs text-gray-400 group-hover:text-gray-500">AIç®¡å®¶: æ— å·²å»¶æœŸä»»åŠ¡...</p>
                </div>
                <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer group">
                    <div class="flex justify-between items-start mb-1"><span class="font-bold text-gray-700 text-xs group-hover:text-black">èåˆç‰ˆç”¨æˆ·åé¦ˆ</span><span class="text-xxs text-gray-400">09:00</span></div>
                    <p class="text-xxs text-gray-400">æ™ºèƒ½ç›‘æ§åŠ©æ‰‹: ### æ¯å‘¨æ¶ˆæ¯...</p>
                </div>
                <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer group">
                    <div class="flex justify-between items-start mb-1"><span class="font-bold text-gray-700 text-xs group-hover:text-black">ä»»åŠ¡è¿½è¸ªå¼€å‘å°åˆ†é˜Ÿ</span><span class="text-xxs text-gray-400">26-01-30</span></div>
                    <p class="text-xxs text-gray-400">ğŸ”´ ä»Šæ—¥é€¾æœŸä»»åŠ¡...</p>
                </div>
            </div>
        </section>

        <!-- 3. DASHBOARD / DOC CENTER -->
        <main class="flex-1 flex flex-col relative overflow-hidden z-10 border-x border-gray-200">
            <!-- HEADER WITH TABS -->
            <div class="h-12 bg-gray-50 border-b border-gray-200 flex items-center justify-between px-4 shrink-0 shadow-sm relative z-30">
                <div class="flex space-x-6 h-full items-end">
                    <button onclick="switchTab('dashboard')" id="tab-dashboard" class="pb-3 text-sm font-bold text-gray-800 border-b-2 border-transparent transition relative top-[1px]"><i class="fa-solid fa-shield-virus mr-2"></i>åº”æ€¥æŒ‡æŒ¥å¤§å±</button>
                    <button onclick="switchTab('docs')" id="tab-docs" class="pb-3 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 transition relative top-[1px]"><i class="fa-solid fa-folder-open mr-2"></i>æ–‡æ¡£ä¸­å¿ƒ</button>
                </div>
                <div class="flex items-center space-x-3 text-gray-400">
                    <i class="fa-solid fa-expand hover:text-gray-600 cursor-pointer"></i>
                    <i class="fa-solid fa-magnifying-glass hover:text-gray-600 cursor-pointer"></i>
                    <img src="https://i.pravatar.cc/150?u=2" class="w-6 h-6 rounded-full border border-gray-300">
                </div>
            </div>

            <div class="flex-1 relative bg-[#0a0a0a]">
                <div id="sim-layer" class="absolute top-4 left-1/2 -translate-x-1/2 z-50 flex flex-col space-y-2 pointer-events-none"></div>

                <!-- VIEW 1: DASHBOARD -->
                <div id="view-dashboard" class="absolute inset-0 flex flex-col transition-opacity duration-300">
                    <div class="h-10 bg-slate-900/90 border-b border-gray-800 flex items-center justify-between px-6 z-20">
                        <div class="flex-1 flex justify-center">
                            <div class="flex items-center w-full max-w-lg relative">
                                <div class="h-0.5 bg-gray-700 w-full absolute top-2.5 -z-10"></div>
                                <div class="flex justify-between w-full text-xxs text-gray-400">
                                    <div class="flex flex-col items-center gap-1"><div class="w-5 h-5 rounded-full bg-gray-600 border-4 border-[#0a0a0a] timeline-node done" id="step-1"></div><span>äº‹ä»¶å‘ç”Ÿ</span></div>
                                    <div class="flex flex-col items-center gap-1"><div class="w-5 h-5 rounded-full bg-gray-600 border-4 border-[#0a0a0a] timeline-node" id="step-2"></div><span>åº”æ€¥å“åº”</span></div>
                                    <div class="flex flex-col items-center gap-1"><div class="w-5 h-5 rounded-full bg-gray-600 border-4 border-[#0a0a0a] timeline-node" id="step-3"></div><span>æ•…éšœå®šä½</span></div>
                                    <div class="flex flex-col items-center gap-1"><div class="w-5 h-5 rounded-full bg-gray-600 border-4 border-[#0a0a0a] timeline-node" id="step-4"></div><span>åº”æ€¥å†³ç­–</span></div>
                                    <div class="flex flex-col items-center gap-1"><div class="w-5 h-5 rounded-full bg-gray-600 border-4 border-[#0a0a0a] timeline-node" id="step-5"></div><span>å¤„ç½®æ¢å¤</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end"><span class="font-mono text-lg text-red-500 font-bold leading-none" id="dash-timer">00:00:00</span></div>
                    </div>
                    
                    <div id="dashboard-grid" class="flex-1 grid grid-cols-12 dashboard-container opacity-30 blur-sm scale-95 transition-all duration-700">
                        <div class="col-span-3 border-r border-gray-800 bg-slate-900/30 p-4 flex flex-col gap-4">
                            <div class="border-l-4 border-blue-600 pl-4 py-1">
                                <h3 class="text-blue-200 text-sm font-bold">NOCäº‹ä»¶æ¦‚å†µ</h3>
                                <div class="text-xxs text-gray-400 mt-1">NOC-20260202-001</div>
                            </div>
                            <div class="bg-black/40 rounded p-3 border border-gray-800">
                                <div class="flex justify-between items-center mb-2"><span class="text-xs text-gray-400">ç­‰çº§</span><span id="level-badge" class="bg-gray-700 text-gray-300 px-2 rounded text-xxs font-bold">å¾…å®šçº§</span></div>
                                <div class="text-xs text-gray-300 leading-relaxed" id="event-desc"><span class="animate-pulse">ç­‰å¾…ç›‘æ§æ•°æ®æ¥å…¥...</span></div>
                            </div>
                            <div class="flex-1 bg-black/40 rounded border border-gray-800 p-2 flex flex-col">
                                <h4 class="text-xxs text-gray-500 mb-2">ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§</h4>
                                <div class="flex-1 relative"><canvas id="bizChart"></canvas></div>
                            </div>
                        </div>
                        <div class="col-span-6 relative flex flex-col">
                            <div class="absolute inset-0 z-0 opacity-20" style="background-image: radial-gradient(#3b82f6 1px, transparent 1px); background-size: 20px 20px;"></div>
                            <div class="relative z-10 w-full h-full p-4 flex items-center justify-center">
                                <div id="topology-container" class="opacity-0 transition-opacity duration-1000"></div>
                            </div>
                            <div class="absolute w-full h-1 bg-blue-500/50 blur-md animate-scan pointer-events-none"></div>
                        </div>
                        <div class="col-span-3 border-l border-gray-800 bg-slate-900/30 flex flex-col">
                            <div class="bg-black/50 p-2 border-b border-gray-800 flex justify-between items-center">
                                <span class="text-xs text-blue-300 font-bold"><i class="fa-solid fa-bars-progress mr-2"></i>å¤„ç½®è¿›åº¦ (SOP)</span>
                            </div>
                            <div id="sop-list" class="flex-1 overflow-y-auto p-3 space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- VIEW 2: DOCS -->
                <div id="view-docs" class="absolute inset-0 bg-white hidden flex flex-col animate-fadeIn">
                    <div class="p-4 bg-white">
                        <div class="relative max-w-3xl">
                            <i class="fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400"></i>
                            <input type="text" placeholder="æœç´¢å½“å‰ç©ºé—´" class="w-full bg-gray-100 text-gray-700 rounded-lg pl-9 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto px-6 pb-6">
                        <h3 class="text-gray-500 text-xs font-bold mb-3 px-2">ä¸€çº§ç›®å½•</h3>
                        <div class="space-y-1" id="file-list-root">
                            <div class="flex items-center p-2 rounded cursor-pointer text-gray-700 hover:bg-gray-100 doc-item"><i class="fa-solid fa-caret-right text-gray-400 mr-2 w-4 text-center"></i><i class="fa-solid fa-folder text-blue-400 mr-2"></i><span class="text-sm">åä½œå¾…åŠåº“</span></div>
                            <div onclick="openReport('full')" class="flex items-center p-2 rounded cursor-pointer text-gray-700 hover:bg-blue-50 doc-item group border border-transparent hover:border-blue-100 transition"><i class="fa-solid fa-file-word text-blue-600 mr-2 ml-6 text-lg group-hover:scale-110 transition"></i><div class="flex flex-col"><span class="text-sm font-medium text-gray-800 group-hover:text-blue-700">NOCå¤ç›˜æŠ¥å‘Š</span><span class="text-[10px] text-gray-400">æ›´æ–°äº åˆšåˆš &bull; AI è‡ªåŠ¨ç”Ÿæˆ</span></div><span class="ml-auto bg-purple-100 text-purple-600 text-xs px-2 py-0.5 rounded-full">New</span></div>
                            <div class="flex items-center p-2 rounded cursor-pointer text-gray-700 hover:bg-gray-100 doc-item"><i class="fa-solid fa-file-lines text-blue-400 mr-2 ml-6"></i><span class="text-sm">åä½œä¸­å¿ƒä½¿ç”¨æŒ‡å—</span></div>
                            <div class="flex items-center p-2 rounded cursor-pointer text-gray-700 hover:bg-gray-100 doc-item"><i class="fa-solid fa-file-excel text-green-500 mr-2 ml-6"></i><span class="text-sm">2025å¹´æ•…éšœç»Ÿè®¡è¡¨.xlsx</span></div>
                        </div>
                    </div>
                </div>

                <!-- DOC MODAL -->
                <div id="doc-viewer" class="absolute inset-0 bg-black/50 z-50 hidden flex justify-end">
                    <div class="w-2/3 h-full bg-white shadow-2xl flex flex-col animate-slideInRight">
                        <div class="h-14 border-b border-gray-200 flex items-center justify-between px-6 bg-gray-50">
                            <div class="flex items-center"><i class="fa-solid fa-file-lines text-blue-600 text-xl mr-3" id="viewer-icon"></i><div><h2 class="text-sm font-bold text-gray-800" id="viewer-title">æ–‡æ¡£æ ‡é¢˜</h2><p class="text-xs text-gray-500">è‡ªåŠ¨å½’æ¡£</p></div></div>
                            <div class="flex space-x-3"><button onclick="closeReport()" class="text-gray-500 hover:text-red-500"><i class="fa-solid fa-xmark text-lg"></i></button></div>
                        </div>
                        <div class="flex-1 overflow-y-auto p-8 bg-white"><div id="markdown-content" class="markdown-body max-w-3xl mx-auto"></div></div>
                    </div>
                </div>
            </div>

            <!-- å…¨æ–°ä¼˜åŒ–çš„å‘å¯¼å¼æ§åˆ¶é¢æ¿ -->
            <div id="demo-guide-panel" class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-gray-900/90 border border-gray-700 p-2 rounded-full flex gap-3 z-50 shadow-2xl backdrop-blur items-center transition-all duration-500">
                <div class="text-white text-xs font-bold pl-2 pr-1 opacity-80"><i class="fa-solid fa-play mr-1 text-blue-400"></i> æ¼”ç¤ºå‘å¯¼</div>
                <button id="guide-btn-1" onclick="executeStep(1)" class="relative px-4 py-1.5 rounded-full bg-red-600 text-white font-bold text-xs transition-all duration-300 ring-2 ring-red-400 ring-offset-2 ring-offset-gray-900 animate-breathe cursor-pointer">è‡ªåŠ¨æ„ŸçŸ¥</button>
                <button id="guide-btn-2" onclick="executeStep(2)" class="px-4 py-1.5 rounded-full bg-gray-700 text-gray-500 font-bold text-xs transition-all duration-300 cursor-not-allowed">æ™ºèƒ½ååŒ</button>
                <button id="guide-btn-3" onclick="executeStep(3)" class="px-4 py-1.5 rounded-full bg-gray-700 text-gray-500 font-bold text-xs transition-all duration-300 cursor-not-allowed">å†³ç­–å‡çº§</button>
                <button id="guide-btn-4" onclick="executeStep(4)" class="px-4 py-1.5 rounded-full bg-gray-700 text-gray-500 font-bold text-xs transition-all duration-300 cursor-not-allowed">å¤ç›˜æ¢å¤</button>
            </div>
        </main>

        <!-- 4. CHAT WINDOW -->
        <section class="w-[340px] bg-light-panel flex flex-col shrink-0 border-l border-light-border">
            <div class="h-12 bg-white border-b border-light-border flex items-center justify-between px-4 shrink-0">
                <div><h2 id="chat-title" class="text-sm font-bold text-gray-800">æ¼”ç»ƒNOC2025... (6)</h2><div class="text-xxs text-gray-400">é•¿æœŸæœ‰æ•ˆ</div></div>
                <div class="text-gray-400 space-x-3 text-xs"><i class="fa-solid fa-phone"></i><i class="fa-solid fa-video"></i><i class="fa-solid fa-ellipsis"></i></div>
            </div>
            <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4 bg-[#f5f7fa]">
                <div class="flex justify-center"><span class="bg-gray-200 text-gray-500 text-[10px] px-2 py-0.5 rounded">11:53</span></div>
                <div class="flex justify-center"><span class="text-gray-400 text-[10px]">æ¬§äºšè²é‚€è¯·æ‚¨åŠ å…¥äº†è¯¥ç¾¤èŠ</span></div>
            </div>
            <div class="bg-white border-t border-light-border p-3 shrink-0">
                <div class="flex space-x-3 text-gray-500 text-sm mb-2 px-1"><i class="fa-regular fa-face-smile hover:text-blue-600 cursor-pointer"></i><i class="fa-solid fa-folder-open hover:text-blue-600 cursor-pointer"></i><i class="fa-solid fa-scissors hover:text-blue-600 cursor-pointer"></i><i class="fa-regular fa-message hover:text-blue-600 cursor-pointer"></i></div>
                <textarea id="chat-input" rows="3" placeholder="å‘é€ç»™ æ¼”ç»ƒNOC2025..." class="w-full text-sm text-gray-800 placeholder-gray-400 bg-transparent border-none resize-none focus:ring-0 p-0"></textarea>
                <div class="flex justify-between items-center mt-1">
                    <div class="text-xxs text-gray-400 flex items-center cursor-pointer hover:text-blue-600"><i class="fa-solid fa-robot mr-1 text-purple-500"></i> æ™ºèƒ½ç›‘æ§åŠ©æ‰‹</div>
                    <button class="bg-blue-100 text-blue-600 hover:bg-blue-200 text-xs px-4 py-1.5 rounded transition font-medium">å‘é€</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Templates -->
    <template id="tpl-ai-msg"><div class="flex items-start space-x-2"><div class="w-8 h-8 rounded-full bg-purple-100 border border-purple-200 flex items-center justify-center shrink-0"><i class="fa-solid fa-robot text-purple-600 text-xs"></i></div><div class="max-w-[90%]"><div class="flex items-center space-x-2 mb-1"><span class="text-xs text-gray-500">æ™ºèƒ½ç›‘æ§åŠ©æ‰‹</span></div><div class="bg-white border border-gray-200 rounded-lg p-3 text-xs text-gray-800 shadow-sm msg-content relative"><div class="absolute -left-1.5 top-3 w-3 h-3 bg-white border-l border-b border-gray-200 transform rotate-45"></div></div></div></div></template>
    <template id="tpl-user-msg"><div class="flex items-start space-x-2 flex-row-reverse space-x-reverse"><img src="https://i.pravatar.cc/150?u=1" class="w-8 h-8 rounded-full border border-gray-200"><div class="max-w-[85%] flex flex-col items-end"><div class="bg-blue-500 text-white rounded-lg p-2.5 text-xs text-left shadow-sm msg-content relative"><div class="absolute -right-1 top-3 w-2 h-2 bg-blue-500 transform rotate-45"></div></div></div></div></template>
    <template id="tpl-other-msg"><div class="flex items-start space-x-2"><img src="https://i.pravatar.cc/150?u=3" class="w-8 h-8 rounded-full border border-gray-200 sender-avatar"><div class="max-w-[85%]"><div class="flex items-center space-x-2 mb-1"><span class="text-xs text-gray-500 sender-name">Name</span></div><div class="bg-gray-100 border border-gray-200 rounded-lg p-2.5 text-xs text-gray-700 shadow-sm msg-content relative"><div class="absolute -left-1 top-3 w-2 h-2 bg-gray-100 transform rotate-45"></div></div></div></div></template>

    <script>
        let bizChart;
        let timerInterval;
        let activeTab = 'dashboard';
        let liveMinutesContent = "";
        let currentGuideStep = 1; // å¼•å¯¼çŠ¶æ€è¿½è¸ª

        // --- å‘å¯¼æ­¥éª¤é…ç½® ---
        const stepConfigs = {
            1: { bg: 'bg-red-600', ring: 'ring-red-400', text: 'è‡ªåŠ¨æ„ŸçŸ¥' },
            2: { bg: 'bg-blue-600', ring: 'ring-blue-400', text: 'æ™ºèƒ½ååŒ' },
            3: { bg: 'bg-orange-600', ring: 'ring-orange-400', text: 'å†³ç­–å‡çº§' },
            4: { bg: 'bg-purple-600', ring: 'ring-purple-400', text: 'å¤ç›˜æ¢å¤' }
        };

        function switchTab(tabName) {
            activeTab = tabName;
            const dashboardView = document.getElementById('view-dashboard');
            const docsView = document.getElementById('view-docs');
            const tabDash = document.getElementById('tab-dashboard');
            const tabDocs = document.getElementById('tab-docs');
            if (tabName === 'dashboard') {
                dashboardView.classList.remove('hidden'); setTimeout(() => dashboardView.style.opacity = '1', 10); docsView.classList.add('hidden');
                tabDash.classList.add('border-blue-600', 'text-blue-600'); tabDash.classList.remove('border-transparent', 'text-gray-800');
                tabDocs.classList.remove('border-blue-600', 'text-blue-600'); tabDocs.classList.add('border-transparent', 'text-gray-500');
            } else {
                dashboardView.style.opacity = '0'; setTimeout(() => dashboardView.classList.add('hidden'), 300); docsView.classList.remove('hidden');
                tabDash.classList.remove('border-blue-600', 'text-blue-600'); tabDash.classList.add('border-transparent', 'text-gray-800');
                tabDocs.classList.add('border-blue-600', 'text-blue-600'); tabDocs.classList.remove('border-transparent', 'text-gray-500');
            }
        }

        function openReport(type) {
            const viewer = document.getElementById('doc-viewer');
            const content = document.getElementById('markdown-content');
            const title = document.getElementById('viewer-title');
            if (type === 'live') {
                title.textContent = "0202æ•…éšœ-å®æ—¶æ™ºèƒ½çºªè¦";
                content.innerHTML = marked.parse(liveMinutesContent || "*æš‚æ— å†…å®¹*");
            } else {
                title.textContent = "NOCå¤ç›˜æŠ¥å‘Š";
                content.innerHTML = marked.parse(`# NOC-20260202-001 æ•…éšœå¤ç›˜æŠ¥å‘Š\n\n- **æ•…éšœç­‰çº§**: P1 (ç¾éš¾çº§)\n- **æ•…éšœæ—¶é•¿**: 32åˆ†16ç§’\n- **æ¢å¤æ—¶é—´**: 2026-02-02 12:32:16\n\n## 1. æ•…éšœæ ¹å› \nç»æ’æŸ¥ï¼Œæ•°æ®åº“ \`DB_PROFIT\` å‡ºç°æ­»é”ã€‚\n\n## 2. å¤„ç†è¿‡ç¨‹å›é¡¾\n- **12:00:01** ç›‘æ§æ•è·å¼‚å¸¸ï¼Œæ™ºèƒ½ç›‘æ§åŠ©æ‰‹å®šçº§ P1ã€‚\n- **12:05:30** è¥¿è¥¿(DBA) æ¥å…¥ï¼Œå®šä½åˆ°æ…¢SQLã€‚\n- **12:30:00** æ‰§è¡Œ Kill Session æ“ä½œã€‚\n\n## 3. æ”¹è¿›æªæ–½ (Action Items)\n| æªæ–½å†…å®¹ | è´Ÿè´£äºº | æˆªæ­¢æ—¥æœŸ |\n| :--- | :--- | :--- |\n| **å¢åŠ  SQL é¢„æ£€æµæ°´çº¿** | @å¼ ä¸‰ | 2026-02-10 |\n\n*æœ¬æŠ¥å‘Šç”± AI-ICC è‡ªåŠ¨ç”Ÿæˆ*`);
            }
            viewer.classList.remove('hidden');
        }
        function closeReport() { document.getElementById('doc-viewer').classList.add('hidden'); }

        function updateTimeline(step) {
            document.querySelectorAll('.timeline-node').forEach((el, idx) => {
                if (idx < step - 1) { el.classList.remove('active'); el.classList.add('done'); }
                else if (idx === step - 1) { el.classList.add('active'); el.classList.remove('done'); }
            });
        }
        function addLog(time, text, status = 'doing') {
            const list = document.getElementById('sop-list');
            const item = document.createElement('div');
            item.className = "flex space-x-3 items-start group";
            item.innerHTML = `<div class="flex flex-col items-center mt-1"><div class="w-2 h-2 rounded-full ${status === 'done' ? 'bg-green-500' : 'bg-blue-500 animate-pulse'}"></div><div class="w-0.5 h-full bg-gray-800 my-0.5 group-last:hidden"></div></div><div class="pb-2 w-full"><div class="text-xs text-gray-500 font-mono mb-0.5">${time}</div><div class="text-xs text-gray-300">${text}</div></div>`;
            list.prepend(item);
        }
        function addChat(type, contentHTML, name = "Other") {
            const box = document.getElementById('chat-box');
            let tplId = type === 'ai' ? 'tpl-ai-msg' : (type === 'user' ? 'tpl-user-msg' : 'tpl-other-msg');
            const clone = document.getElementById(tplId).content.cloneNode(true);
            if (type === 'other') {
                clone.querySelector('.sender-name').textContent = name;
                if (name.includes('ä¹ä¹')) clone.querySelector('.sender-avatar').src = 'https://i.pravatar.cc/150?u=12'; 
                else if (name.includes('è¥¿è¥¿')) clone.querySelector('.sender-avatar').src = 'https://i.pravatar.cc/150?u=4'; 
                else if (name.includes('æŒ‡æŒ¥')) clone.querySelector('.sender-avatar').src = 'https://i.pravatar.cc/150?u=11';
                else clone.querySelector('.sender-avatar').src = 'https://i.pravatar.cc/150?u=8';
            }
            if (type === 'task') { clone.querySelector('.msg-content').innerHTML = contentHTML; }
            else {
                const el = clone.querySelector('.msg-content');
                if (contentHTML.includes('<')) el.innerHTML = contentHTML; else el.textContent = contentHTML;
            }
            box.appendChild(clone); box.scrollTop = box.scrollHeight;
        }

        // --- æ ¸å¿ƒæ¼”ç¤ºåœºæ™¯é€»è¾‘ ---
        function scenario1() {
            const simLayer = document.getElementById('sim-layer');
            simLayer.innerHTML = `
                <div class="bg-white/90 backdrop-blur shadow-lg rounded-lg p-3 border-l-4 border-orange-500 sim-toast flex items-center space-x-3 w-72">
                    <div class="bg-orange-100 p-2 rounded-full"><i class="fa-solid fa-headset text-orange-500"></i></div>
                    <div><div class="text-xs font-bold text-gray-800">å®¢æœç³»ç»Ÿæ¥å…¥</div><div class="text-[10px] text-gray-500">æ¥åˆ° 3 é€šå…³äºâ€œæ”¯ä»˜å¤±è´¥â€çš„æŠ•è¯‰ç”µè¯</div></div>
                </div>
                <div class="bg-white/90 backdrop-blur shadow-lg rounded-lg p-3 border-l-4 border-red-500 sim-toast flex items-center space-x-3 w-72" style="animation-delay: 0.2s">
                    <div class="bg-red-100 p-2 rounded-full"><i class="fa-solid fa-server text-red-500"></i></div>
                    <div><div class="text-xs font-bold text-gray-800">Zabbix å‘Šè­¦</div><div class="text-[10px] text-gray-500">DB_PROFIT CPU > 95% (æŒç»­2min)</div></div>
                </div>
            `;
            setTimeout(() => simLayer.innerHTML = '', 4000);
            const grid = document.getElementById('dashboard-grid'); grid.classList.remove('opacity-30', 'blur-sm', 'scale-95'); grid.classList.add('opacity-100', 'blur-0', 'scale-100');
            let sec = 0; if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => { sec++; const d = new Date(0); d.setSeconds(sec); document.getElementById('dash-timer').innerText = d.toISOString().substr(11, 8); }, 1000);
            document.getElementById('level-badge').innerText = 'P1 ç¾éš¾çº§'; document.getElementById('level-badge').className = "bg-red-600 text-white px-2 rounded text-xxs font-bold animate-pulse";
            document.getElementById('event-desc').innerText = "å®¢æœåé¦ˆæ”¯ä»˜å¤±è´¥ï¼Œå…³è”æ•°æ®åº“ CPU å‘Šè­¦ã€‚åˆ¤å®šä¸ºæ ¸å¿ƒäº¤æ˜“é“¾è·¯ä¸­æ–­ã€‚";
            bizChart.data.datasets[0].borderColor = '#ef4444'; bizChart.data.datasets[0].data = [100, 98, 20, 5, 0, 0, 0, 0, 0, 0]; bizChart.update();
            updateTimeline(2);
            setTimeout(() => addLog('12:00:01', 'æ„ŸçŸ¥ï¼šæ¥å…¥ç”µè¯æŠ•è¯‰ & ç›‘æ§å‘Šè­¦', 'done'), 500);
            setTimeout(() => addLog('12:00:05', 'AIè‡ªåŠ¨å®šçº§: P1', 'done'), 1000);

            setTimeout(() => {
                document.getElementById('chat-title').innerText = "P1-20260202-æ ¸å¿ƒæ‰¿ä¿ç³»ç»Ÿæˆæœº (6)";
                addChat('ai', `
                    <div class="space-y-2">
                        <div class="text-xs text-blue-600 bg-blue-50 border border-blue-100 p-2 rounded"><i class="fa-solid fa-people-group mr-1.5"></i><b>æ­£åœ¨åˆ›å»ºåº”æ€¥ç¾¤ç»„...</b></div>
                        <div class="text-xs text-gray-500 border-b border-gray-200 pb-2 leading-relaxed"><i class="fa-solid fa-user-tag mr-1"></i> <b>å·²æŒ‡å®šæŒ‡æŒ¥å®˜ï¼š<span class="text-blue-600">@é™ˆæ€»</span></b><br><span class="text-gray-500 pl-5">å·²æ‹‰å…¥å…³è”äººå‘˜ï¼š@è¥¿è¥¿(DBA) @ä¹ä¹(å¼€å‘) @ç‹äº”(å…¬å…³)</span></div>
                        <div class="font-bold text-red-500"><i class="fa-solid fa-bullhorn mr-1"></i> æ•…éšœé€šæŠ¥å…¬å‘Š</div>
                        <ul class="list-disc pl-4 text-gray-600 space-y-1"><li><b>å‘Šè­¦æ—¶é—´</b>ï¼š12:00:01</li><li><b>è´Ÿè´£äºº</b>ï¼šè¥¿è¥¿(DBA)</li><li><b>æ•…éšœæè¿°</b>ï¼šæ ¸å¿ƒäº¤æ˜“é“¾è·¯ä¸­æ–­ï¼Œäº¤æ˜“é‡è·Œé›¶ã€‚</li></ul>
                    </div>
                `);
                addLog('12:00:06', 'AIè‡ªåŠ¨å»ºç¾¤: P1-20260202-æ ¸å¿ƒ...', 'done');
            }, 1000);
        }

        function scenario2() {
            addChat('other', 'å¤§å®¶éƒ½åœ¨ç¾¤é‡Œäº†ï¼Œç°åœ¨å¼€å§‹åº”æ€¥ä¼šè®®ï¼ŒåŒæ­¥ä¸€ä¸‹æƒ…å†µã€‚', 'é™ˆæ€»(æŒ‡æŒ¥å®˜)');
            setTimeout(() => {
                addChat('ai', `<div class="flex items-center space-x-2 text-blue-600 bg-blue-50 p-2 rounded border border-blue-100"><i class="fa-solid fa-microphone-lines animate-pulse"></i><span>"è®°ä¸€ç¬”" æ­£åœ¨å½•éŸ³ä¸­...</span></div>`);
                setTimeout(() => {
                    const minutesHtml = `<div class="font-bold border-b border-gray-200 pb-1 mb-2 text-purple-700"><i class="fa-solid fa-clipboard-list mr-1"></i> å®æ—¶ä¼šè®®çºªè¦ & ç»“è®º</div><div class="space-y-2 text-gray-600 text-xs"><div><b class="text-gray-800">å…³é”®ç»“è®ºï¼š</b><br>1. æ•…éšœæ ¹å› æ˜¯ DB_PROFIT å‡ºç°æ…¢SQLé”è¡¨ã€‚<br>2. å½±å“èŒƒå›´ï¼šæ ¸å¿ƒäº¤æ˜“é“¾è·¯å®Œå…¨ä¸­æ–­ã€‚</div><div><b class="text-gray-800">å†³ç­–æŒ‡ä»¤ï¼š</b><br>è¯· <span class="text-blue-600 font-bold">@è¥¿è¥¿(DBA)</span> ç«‹å³æ‰§è¡Œ Kill Session æ“ä½œã€‚</div></div>`;
                    addChat('ai', minutesHtml);
                    addLog('12:05:30', 'ä¼šè®®çºªè¦ï¼šç¡®è®¤é”è¡¨ï¼Œå†³å®šKill Session', 'doing');
                    updateTimeline(3);

                    liveMinutesContent = "# å®æ—¶ä¼šè®®çºªè¦\n\n- **å…³é”®ç»“è®º**: ç¡®è®¤æ…¢SQLé”è¡¨ã€‚\n- **å†³ç­–**: æ‰§è¡Œ Kill Sessionã€‚";
                    const fileRoot = document.getElementById('file-list-root');
                    if (fileRoot.children.length < 5) {
                        const newFileHTML = `<div onclick="openReport('live')" class="flex items-center p-2 rounded cursor-pointer text-gray-700 bg-purple-50 border border-purple-200 doc-item group transition animate-pulse"><i class="fa-solid fa-file-signature text-purple-600 mr-2 ml-6 text-lg"></i><div class="flex flex-col"><span class="text-sm font-medium text-gray-900">0202æ•…éšœ-å®æ—¶æ™ºèƒ½çºªè¦</span><span class="text-[10px] text-purple-500">AI æ­£åœ¨å®æ—¶è®°å½•...</span></div></div>`;
                        const tempDiv = document.createElement('div'); tempDiv.innerHTML = newFileHTML; fileRoot.insertBefore(tempDiv.firstElementChild, fileRoot.children[1]);
                    }

                    const topo = document.getElementById('topology-container'); topo.classList.remove('opacity-0');
                    topo.innerHTML = `<div class="relative w-40 h-40 animate-pulse"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-red-900/50 rounded-full flex items-center justify-center border-2 border-red-500 shadow-[0_0_20px_red]"><i class="fa-solid fa-database text-red-500 text-2xl"></i></div></div>`;
                }, 2000);
            }, 1000);
        }

        function scenario3() {
            addChat('other', 'å·²æ‰§è¡Œ Kill Session æ“ä½œï¼Œæ­£åœ¨è§‚å¯Ÿè´Ÿè½½å›è½æƒ…å†µã€‚', 'è¥¿è¥¿(DBA)');
            setTimeout(() => {
                addLog('12:15:00', 'ã€AIæ•æ‰ã€‘å…³é”®æ“ä½œ: DBAæ‰§è¡ŒKill Session', 'doing');
                updateTimeline(4);
                addChat('ai', `<div class="text-green-600"><i class="fa-solid fa-check-circle mr-1"></i><b>æ“ä½œå·²åŒæ­¥</b><br>ç›‘æµ‹åˆ°å…³é”®å¤„ç½®åŠ¨ä½œï¼Œå·²è‡ªåŠ¨åŒæ­¥è‡³æ•…éšœæ—¶é—´è½´ã€‚</div>`);
            }, 1000);
        }

        function scenario4() {
            bizChart.data.datasets[0].borderColor = '#10b981'; bizChart.data.datasets[0].data = [0, 10, 30, 60, 80, 95, 98, 99, 100, 100]; bizChart.update();
            document.getElementById('dash-timer').classList.replace('text-red-500', 'text-green-500'); updateTimeline(5);
            document.getElementById('topology-container').innerHTML = `<div class="w-16 h-16 bg-green-900/20 rounded-full flex items-center justify-center border-2 border-green-500"><i class="fa-solid fa-check text-green-500 text-2xl"></i></div>`;

            setTimeout(() => {
                const overlay = document.createElement('div'); overlay.className = "absolute inset-0 bg-black/80 z-50 flex items-center justify-center flex-col animate-pulse";
                overlay.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles text-4xl text-purple-500 mb-4"></i><h2 class="text-xl text-white font-bold">æ•…éšœå·²æ¢å¤</h2>`;
                document.getElementById('dashboard-grid').appendChild(overlay);

                addChat('ai', `
                    <div class="space-y-2">
                        <div class="text-green-600 font-bold"><i class="fa-solid fa-check-double mr-1"></i>æ•…éšœå¤„ç†ç»“æŸ</div>
                        <div class="text-gray-500 text-xs">AIå·²è‡ªåŠ¨æ±‡æ€»å…¨æµç¨‹è®°å½•å¹¶å½’æ¡£ã€‚</div>
                        <div class="bg-gray-50 p-2 rounded border border-gray-200">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-gray-700">æ•…éšœå¤ç›˜æŠ¥å‘Š.pdf</span>
                                <span class="text-xxs text-gray-400">å¾…ç¡®è®¤</span>
                            </div>
                            <button onclick="switchTab('docs')" class="w-full bg-blue-600 hover:bg-blue-500 text-white text-xs py-1 rounded transition">
                                <i class="fa-solid fa-upload mr-1"></i>æ ¸å¯¹å¹¶ä¸€é”®åŒæ­¥
                            </button>
                        </div>
                    </div>
                `);
                setTimeout(() => overlay.remove(), 2500);
            }, 1000);
        }

        function runScenario(n) {
            if (activeTab !== 'dashboard') switchTab('dashboard');
            if (n === 1) scenario1(); if (n === 2) scenario2(); if (n === 3) scenario3(); if (n === 4) scenario4();
        }

        // --- å…¨æ–°å‘å¯¼ç®¡ç†ç³»ç»Ÿ ---
        function activateStepButton(n) {
            const btn = document.getElementById(`guide-btn-${n}`);
            if(!btn) return;
            // æ·»åŠ ä¸“å±é¢œè‰²ã€å‘¼å¸ç‰¹æ•ˆå¹¶è§£é”ç‚¹å‡»
            btn.className = `relative px-4 py-1.5 rounded-full ${stepConfigs[n].bg} text-white font-bold text-xs transition-all duration-300 ring-2 ${stepConfigs[n].ring} ring-offset-2 ring-offset-gray-900 animate-breathe cursor-pointer`;
        }

        function completeStepButton(n) {
            const btn = document.getElementById(`guide-btn-${n}`);
            if(!btn) return;
            // å˜æˆç»¿è‰²çš„å·²å®Œæˆæ‰“å‹¾çŠ¶æ€
            btn.className = `px-4 py-1.5 rounded-full bg-green-600 text-white font-bold text-xs transition-all duration-300 opacity-80 cursor-default`;
            btn.innerHTML = `<i class="fa-solid fa-check mr-1"></i>` + stepConfigs[n].text;
        }

        function executeStep(n) {
            // é˜²å‘†è®¾è®¡ï¼šå¦‚æœç‚¹çš„ä¸æ˜¯å½“å‰æ¿€æ´»çš„æ­¥éª¤ï¼Œç›´æ¥å¿½ç•¥
            if (n !== currentGuideStep) return;
            
            // 1. æ‰§è¡ŒçœŸå®çš„ä¸šåŠ¡å±•ç¤ºé€»è¾‘
            runScenario(n);
            
            // 2. å°†å½“å‰æŒ‰é’®å˜æˆâ€œå®Œæˆâ€çŠ¶æ€
            completeStepButton(n);
            
            // 3. å‡†å¤‡ä¸‹ä¸€ä¸ªæ­¥éª¤ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            if (n < 4) {
                currentGuideStep++;
                // ç¨å¾®å»¶è¿Ÿä¸€ä¸‹äº®èµ·ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿå¤„ç†æ—¶é—´ï¼Œä½“éªŒæ›´å¥½
                setTimeout(() => activateStepButton(currentGuideStep), 600);
            }
        }

        window.onload = () => {
            const ctx = document.getElementById('bizChart').getContext('2d');
            bizChart = new Chart(ctx, { type: 'line', data: { labels: Array(10).fill(''), datasets: [{ label: 'äº¤æ˜“é‡', data: [100, 99, 98, 100, 99, 98, 97, 99, 100, 99], borderColor: '#10b981', borderWidth: 2, tension: 0.4, pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false, min: 0 } }, animation: false } });
            switchTab('dashboard');
        };
    </script>
</body>
</html>
